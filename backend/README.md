 # FastAPI Backend

 This folder contains the FastAPI backend for the HealthAid project. The README focuses on developer setup, local run instructions, migrations, and developer tooling (formatters/linting/pre-commit).

 ## Repository layout (important files)

 - `main.py` — FastAPI app entrypoint used by Uvicorn.
 - `run.py` — convenience script that starts Uvicorn and reads `PORT` from settings.
 - `requirements.txt` — pinned Python dependencies used in runtime and CI.
 - `pyproject.toml` — ruff/black configuration.
 - `alembic/` — database migrations and `alembic.ini`.
 - `app/` — application package (routers, models, config).
 - `Dockerfile` — backend container image definition.

 ## Environment & secrets

 The application uses `pydantic-settings` and reads an `.env` file by default (see `app/api/core/config.py`). Required environment variables:

 - `DATABASE_URL` — full SQLAlchemy-compatible database URL (e.g. `postgresql+psycopg2://user:pass@host:5432/dbname` or `mysql+mysqlconnector://user:pass@host:3306/dbname`).
 - `SECRET_KEY` — secret used for signing tokens.
 - `ACCESS_TOKEN_EXPIRE_MINUTES` — integer (token expiry minutes).
 - `REFRESH_TOKEN_EXPIRE_DAYS` — integer (refresh token expiry days).
 - `PORT` — port the app listens on (default: `8000`).

 Create a `.env` file at the `backend/` root (or set variables in your shell). Example `.env` (DO NOT commit secrets):

 ```dotenv
 # .env (example)
 DATABASE_URL=postgresql+psycopg2://healthaid:password@localhost:5432/healthaid_db
 SECRET_KEY=replace_this_with_a_secure_random_string
 ACCESS_TOKEN_EXPIRE_MINUTES=60
 REFRESH_TOKEN_EXPIRE_DAYS=7
 PORT=8000
 ```

 Tip: Use a secrets manager for production or docker-compose environment variables rather than committing `.env` to source control.

 ## Quick local setup

 1. Create and activate a virtual environment (macOS / zsh example):

 ```bash
 python -m venv .venv
 source .venv/bin/activate
 ```

 2. Install runtime and developer dependencies:

 ```bash
 pip install -r requirements.txt
 pip install ruff black pre-commit
 ```

 3. Create `.env` as shown above and ensure your local DB is running and reachable using `DATABASE_URL`.

 4. Run migrations (see next section) then start the app:

 ```bash
 # run migrations
 alembic upgrade head

 # start the API for development
 uvicorn main:app --reload
 ```

 Alternatively you can run `python run.py` which uses `app` settings for the port.

 ## Database & Migrations (Alembic)

 Alembic is configured under `alembic/`. The `alembic/env.py` loads environment variables using `python-dotenv` and expects `DATABASE_URL` to be present. Basic workflow:

 ```bash
 # create an autogenerated revision after model changes
 alembic revision --autogenerate -m "describe change"

 # apply migrations to the database
 alembic upgrade head

 # show current heads
 alembic heads

 # downgrade one revision
 alembic downgrade -1
 ```

 If you run into issues, ensure `DATABASE_URL` is exported in your shell or present in the `.env` file in the `backend/` folder.

 ## Docker & docker-compose

 The repository contains a `Dockerfile` for the backend and a top-level `docker-compose.yml` to orchestrate services (backend, database, frontend, etc.). To build and run the backend in Docker (example):

 ```bash
 # from repository root
 docker-compose up --build backend
 ```

 Adjust service names in the compose file as needed. When running in Docker, pass environment variables via the compose file or a `.env` referenced by compose.

 ## Formatting, linting, and pre-commit

 We recommend the following tools for local development: `ruff` (linter and quick fixer), `black` (formatter), and `pre-commit` (git hooks).

 Common commands:

 ```bash
 # Format files with ruff's formatter
 ruff format .

 # Run ruff and automatically fix fixable issues
 ruff check . --fix

 # Run ruff in check-only mode (reports issues, doesn't modify files)
 ruff check .

 # Run black to format files explicitly (optional; ruff may already format)
 black .

 # pre-commit: install hooks for the repo
 pre-commit install

 # run all pre-commit hooks across the repo (use before PR)
 pre-commit run --all-files
 ```

 The repository's `pyproject.toml` includes ruff/black settings. Use `ruff check .` in CI to ensure code quality before merging.

 ## Tests

 Run tests with `pytest`:

 ```bash
 pytest -q
 ```

 ## Contributing checklist

 Before opening a PR:

 1. Ensure your `.env` is configured for local development (or your CI secrets are set).
 2. Run `pre-commit run --all-files` and fix issues.
 3. Run `ruff check .` (or `ruff check . --fix`) and `black .` as needed.
 4. Run tests: `pytest -q`.

 Thanks for contributing! If you want, I can also:

 - add a `.env.example` file to the repo with non-sensitive defaults,
 - add a GitHub Actions CI workflow that runs `ruff check .`, `pre-commit run --all-files`, and `pytest` on PRs.
